<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç•™è¨€æ¿ - ä¸¹ä¸¹çš„ç²‰é›ªä¹‹æ—…</title>
    <meta name="description" content="é‡‘å®å’Œä¸¹ä¸¹çš„ç•™è¨€æ¿">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&family=Noto+Sans+SC:wght@400;500&family=DM+Serif+Display&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/src/styles/base.css">
    <link rel="stylesheet" href="/src/styles/board.css">
</head>

<body>
    <a href="/" class="back-link">â† è¿”å›</a>

    <main class="board-page">
        <header class="board-header">
            <h1>ç•™è¨€æ¿</h1>
            <p>é‡‘å®å’Œä¸¹ä¸¹çš„ç§˜å¯†åŸºåœ°</p>
        </header>

        <!-- ç”¨æˆ·é€‰æ‹© -->
        <div class="user-select">
            <button class="user-btn active" data-user="é‡‘å®">
                <span class="user-emoji">ğŸ‘¦</span>
                <span>é‡‘å®</span>
            </button>
            <button class="user-btn" data-user="ä¸¹ä¸¹">
                <span class="user-emoji">ğŸ‘§</span>
                <span>ä¸¹ä¸¹</span>
            </button>
        </div>

        <!-- ç•™è¨€åˆ—è¡¨ -->
        <section class="messages-section">
            <div class="messages-list" id="messages-list">
                <div class="empty-state">
                    <p>è¿˜æ²¡æœ‰ç•™è¨€</p>
                    <p>è¯´ç‚¹ä»€ä¹ˆå§ï½</p>
                </div>
            </div>

            <div class="message-input">
                <textarea id="message-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..."></textarea>
                <button id="send-message">å‘é€</button>
            </div>
        </section>

        <!-- è¿”å›æ¸…å•é“¾æ¥ -->
        <a href="/pages/board.html" class="back-to-checklist">
            âœ… è¿”å›å‡†å¤‡æ¸…å•
        </a>
    </main>

    <script type="module">
        let currentUser = 'é‡‘å®';

        document.querySelectorAll('.user-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.user-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentUser = btn.dataset.user;
            });
        });

        function loadMessages() {
            const messages = JSON.parse(localStorage.getItem('messages') || '[]');
            const list = document.getElementById('messages-list');

            if (messages.length === 0) {
                list.innerHTML = '<div class="empty-state"><p>è¿˜æ²¡æœ‰ç•™è¨€</p><p>è¯´ç‚¹ä»€ä¹ˆå§ï½</p></div>';
                return;
            }

            list.innerHTML = messages.map(msg => {
                const date = new Date(msg.timestamp);
                const timeStr = `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                return `
          <div class="message-item ${msg.author === 'é‡‘å®' ? 'from-jinbao' : 'from-dandan'}">
            <div class="message-header">
              <span class="message-author">${msg.author === 'é‡‘å®' ? 'ğŸ‘¦' : 'ğŸ‘§'} ${msg.author}</span>
              <span class="message-time">${timeStr}</span>
            </div>
            <div class="message-content">${msg.content}</div>
          </div>
        `;
            }).join('');
        }

        loadMessages();

        document.getElementById('send-message').addEventListener('click', () => {
            const input = document.getElementById('message-input');
            const content = input.value.trim();
            if (!content) return;

            const messages = JSON.parse(localStorage.getItem('messages') || '[]');
            messages.unshift({
                author: currentUser,
                content: content,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('messages', JSON.stringify(messages));

            input.value = '';
            loadMessages();
        });
    </script>
</body>

</html>